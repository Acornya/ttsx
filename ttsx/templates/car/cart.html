{%extends 'base.html'%}
{%block js%}
    <script>
        $(function () {
            base()



            $('.add').click(function () {
               ben = $(this).next().val()
                kucun = parseInt($(this).prev().val())
                ben = parseInt(ben)+1
                if(ben>kucun)
                {
                    ben = kucun
                }
                $(this).next().val(ben)

               base()


            })
            $('.minus').click(function () {
                ben = $(this).prev().val()

                ben = parseInt(ben)-1
                if(ben<1)
                {
                    ben = 1
                }

                $(this).prev().val(ben)


                base()
            })
            $('#check').click(function () {
                var mark = $('#check').prop("checked")
                $('.col01 input').prop("checked", mark)
                base()
            })

            $('.col01 input').click(function () {
                base()
            })





            $('.cart_list_td .col08 a').click(function () {
                var msg = "you're sure delete?"
                if(confirm(msg) == true) {
                    var del_id = $(this).next().val()
                    $(this).parents('.cart_list_td').html('')
                    base()
{#                    $.get('/car/dele/',{'del_id':del_id},function (data) {#}
{#                        if(data.flag)#}
{#                        {#}
{#                            alert('dele')#}
{#                            $(this).parents('.cart_list_td').hide()#}
{#                        }#}
{#                        else#}
{#                        {#}
{#                            alert('not dele')#}
{#                        }#}
{#                    })#}


                }
                else {
                    return false
                }

            })








            function base() {
                var total_sum = 0
                var times = 0
                $('.cart_list_td ').each(function (i) {
                danjia = parseFloat($(this).children('.col05').text())
                console.log($(this).children('.col05').text())
                shuliang = parseInt($(this).find('.num_show').val())
                total = danjia * shuliang
                $(this).find('.col07').text(total.toFixed(2)+'元')

                    if($(this).find(".col01 input").prop("checked"))
                    {
                        times++
                        total_sum += parseFloat(total.toFixed(2))
                    }

            });
                $('.settlements .col03 em').text(total_sum.toFixed(2));
                $('.settlements .col03 b').text(times);


            }
        })
    </script>
{%endblock js%}

{%block body%}


	<div class="total_count">全部商品<em>{{ total }}</em>件</div>
	<ul class="cart_list_th clearfix">
		<li class="col01">商品名称</li>
		<li class="col02">商品单位</li>
		<li class="col03">商品价格</li>
		<li class="col04">数量</li>
		<li class="col05">小计</li>
		<li class="col06">操作</li>
	</ul>
    {% for one in goodsobj %}
	<ul class="cart_list_td clearfix">
		<li class="col01"><input type="checkbox" name="" checked="checked"></li>
		<li class="col02"><img src="/static/{{one.obj.gimg}}"></li>
		<li class="col03">{{ one.obj.gtitle }}<br><em>{{ one.obj.gprice }}元/{{ one.obj.gunit }}</em></li>
		<li class="col04">{{ one.obj.gunit }}</li>
		<li class="col05">{{ one.obj.gprice }}元</li
		<li class="col06">
			<div class="num_add">
                <input type="hidden" value={{ one.obj.gkucun }} id="kucun">
				<a href="javascript:;" class="add fl">+</a>
				<input type="text" class="num_show fl" value="{{ one.count }}">
				<a href="javascript:;" class="minus fl">-</a>
			</div>
		</li>
		<li class="col07">{{ one.obj.gprice }}元</li>
		<li class="col08"><a href="javascript:;">删除</a>
            <input type="hidden" value={{ one.obj.id }}>
        </li>
	</ul>
    {% endfor %}


	

	<ul class="settlements">
		<li class="col01"><input type="checkbox" name="" checked="" id="check"></li>
		<li class="col02">全选</li>
		<li class="col03">合计(不含运费)：<span>¥</span><em>42.60</em><br>共计<b>2</b>件商品</li>
		<li class="col04"><a href="">去结算</a></li>
	</ul>
{%endblock body%}